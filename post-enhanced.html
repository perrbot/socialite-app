  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Socialite - Create and share amazing posts with your community. üíé‚ú® #SocialiteGlowUp" />
  <meta name="keywords" content="social media, posts, community, sharing, create posts, Socialite, viral content, luxury social network" />
  <meta name="author" content="Socialite Team" />
  <meta name="robots" content="index, follow" />
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://socialite.com/post-enhanced" />
  <meta property="og:title" content="Socialite - Create Post (TikTok-like)" />
  <meta property="og:description" content="Create and share amazing posts with your community. üíé‚ú® #SocialiteGlowUp" />
  <meta property="og:image" content="https://socialite.com/images/post-enhanced.jpg" />
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://socialite.com/post-enhanced" />
  <meta property="twitter:title" content="Socialite - Create Post (TikTok-like)" />
  <meta property="twitter:description" content="Create and share amazing posts with your community. üíé‚ú® #SocialiteGlowUp" />
  <meta property="twitter:image" content="https://socialite.com/images/post-enhanced.jpg" />
  <title>Socialite - Create Post (TikTok-like)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" onerror="this.href='';document.body.style.fontFamily='sans-serif';">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Firebase (compat) for docs: replace placeholders with your project's config -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      height: 100vh;
      width: 100vw;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }
    .container {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: 400px;
      max-height: 100vh;
    }
    video, canvas {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }
    canvas {
      pointer-events: none;
    }
    .controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .record-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: red;
      border: 4px solid white;
      cursor: pointer;
      transition: all 0.3s;
    }
    .record-btn.recording {
      background: transparent;
      border-color: red;
    }
    .mode-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      font-size: 20px;
    }
    .music-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      font-size: 20px;
    }
    .effects-panel {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: none;
      flex-direction: column;
      gap: 10px;
    }
    .effect-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      font-size: 16px;
    }
    .text-input {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 10px;
      border: none;
      font-size: 18px;
      text-align: center;
      width: 80%;
      max-width: 300px;
    }
    .save-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(0, 255, 0, 0.5);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }
    .effects-toggle {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      font-size: 20px;
    }
    .text-toggle {
      position: absolute;
      bottom: 120px;
      left: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      font-size: 20px;
    }
    .timer {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 18px;
      font-weight: bold;
      display: none;
    }
    .post-btn {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(0, 255, 0, 0.7);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      display: none;
    }
    /* Sign-in Modal */
    .signin-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .signin-modal.active {
      display: flex;
    }
    .signin-modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      position: relative;
    }
    .signin-modal-content h2 {
      margin-bottom: 15px;
      color: #333;
      font-size: 24px;
    }
    .signin-modal-content p {
      color: #666;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .signin-modal-content button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .signin-btn {
      background: #1f2937;
      color: white;
    }
    .signin-btn:hover {
      background: #111827;
    }
    .demo-btn {
      background: #e5e7eb;
      color: #333;
    }
    .demo-btn:hover {
      background: #d1d5db;
    }
    .close-btn {
      background: transparent;
      color: #999;
      font-size: 20px;
      padding: 0;
      position: absolute;
      top: 10px;
      right: 15px;
      width: auto;
      height: auto;
      border: none;
      cursor: pointer;
    }
    /* Template Guide */
    .template-guide {
      position: absolute;
      bottom: 100px;
      right: 20px;
      width: 120px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 8px;
      font-size: 11px;
      display: none;
      z-index: 100;
    }
    .template-guide.show {
      display: block;
    }
    .template-guide h4 {
      margin-bottom: 8px;
      font-weight: 600;
    }
    .template-guide ul {
      list-style: none;
      padding: 0;
    }
    .template-guide li {
      margin: 4px 0;
      opacity: 0.9;
    }
    .auth-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: auto;
      height: 40px;
      padding: 0 12px;
      border-radius: 20px;
      background: rgba(255,255,255,0.9);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <button id="auth-btn" class="auth-btn" title="Sign in">Sign in</button>
    <div id="signin-modal" class="signin-modal">
      <div class="signin-modal-content">
        <button class="close-btn" id="close-signin" title="Close">‚úï</button>
        <h2>Sign In to Post</h2>
        <p>Create an authenticated post to share with your account.</p>
        <button class="signin-btn" id="modal-signin-btn">Sign in with Google</button>
        <p> style="color: #999; font-size: 12px; margin: 15px 0;">or</p>
        <button class="demo-btn" id="demo-post-btn">Post as Demo (Public)</button>
      </div>
    </div>
    <div id="template-guide" class="template-guide">
      <h4>üìù Post Tips:</h4>
      <ul>
        <li>‚úì Record 6-60 sec</li>
        <li>‚úì Add engaging text</li>
        <li>‚úì Use effects</li>
        <li>‚úì Share & inspire</li>
      </ul>
    </div>
    <video id="video" autoplay muted></video>
    <canvas id="canvas"></canvas>
    <button class="save-btn" id="save-btn" aria-label="Save" title="Save"><i class="fas fa-save"></i></button>
    <button class="music-btn" id="music-btn" aria-label="Add Music" title="Add Music"><i class="fas fa-music"></i></button>
    <button class="effects-toggle" id="effects-toggle" aria-label="Effects" title="Effects"><i class="fas fa-magic"></i></button>
    <button class="text-toggle" id="text-toggle" aria-label="Add Text" title="Add Text"><i class="fas fa-font"></i></button>
    <div class="effects-panel" id="effects-panel">
      <button class="effect-btn" data-filter="none">None</button>
      <button class="effect-btn" data-filter="grayscale(100%)">Gray</button>
      <button class="effect-btn" data-filter="sepia(100%)">Sepia</button>
      <button class="effect-btn" data-filter="invert(100%)">Invert</button>
    </div>
    <textarea class="text-input" id="text-input" placeholder="Add text..."></textarea>
    <div class="timer" id="timer">00:00</div>
    <button class="post-btn" id="post-btn" aria-label="Post" title="Post"><i class="fas fa-paper-plane"></i></button>
    <div class="controls">
      <button class="mode-btn" id="mode-btn" aria-label="Switch Mode" title="Switch Mode"><i class="fas fa-camera"></i></button>
      <button class="record-btn" id="record-btn" aria-label="Record Video" title="Record Video"></button>
    </div>
  </div>
  <script>
    // ----- Firebase configuration (fill with your project's values) -----
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_API_KEY",
      authDomain: "REPLACE_WITH_AUTH_DOMAIN",
      projectId: "REPLACE_WITH_PROJECT_ID",
      appId: "REPLACE_WITH_APP_ID"
    };
    if (!window.firebase || !firebase.apps) {
      console.warn('Firebase compat scripts not loaded or incompatible.');
    }
    try {
      if (firebase && !firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
    } catch (e) {
      console.warn('Firebase init error (docs page):', e.message || e);
    }

    // Auth UI elements
    const authBtn = document.getElementById('auth-btn');
    let currentIdToken = null;

    function updateAuthUI(user) {
      if (user) {
        authBtn.textContent = (user.displayName || user.email || 'Signed in') + ' ‚Äî Sign out';
        authBtn.title = 'Sign out';
        // ensure post button visible when signed in
        postBtn.style.display = 'flex';
      } else {
        authBtn.textContent = 'Sign in';
        authBtn.title = 'Sign in';
        postBtn.style.display = 'none';
      }
    }

    // Sign-in with Google popup (docs/demo friendly)
    async function signIn() {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        await firebase.auth().signInWithPopup(provider);
      } catch (err) {
        console.error('Sign-in failed:', err);
        alert('Sign-in failed: ' + (err.message || err));
      }
    }

    async function signOut() {
      try {
        await firebase.auth().signOut();
        currentIdToken = null;
      } catch (err) {
        console.error('Sign-out failed:', err);
      }
    }

    // Monitor auth state and refresh ID token when necessary
    if (firebase && firebase.auth) {
      firebase.auth().onAuthStateChanged(async (user) => {
        if (user) {
          try {
            currentIdToken = await user.getIdToken(true);
          } catch (e) {
            console.warn('Failed to get ID token:', e);
            currentIdToken = null;
          }
        } else {
          currentIdToken = null;
        }
        updateAuthUI(user);
      });
    }

    authBtn.addEventListener('click', async () => {
      const user = firebase && firebase.auth && firebase.auth().currentUser;
      if (user) {
        await signOut();
      } else {
        await signIn();
      }
    });

    // Modal handlers
    const signinModal = document.getElementById('signin-modal');
    const templateGuide = document.getElementById('template-guide');

    document.getElementById('close-signin').addEventListener('click', () => {
      signinModal.classList.remove('active');
    });

    document.getElementById('modal-signin-btn').addEventListener('click', async () => {
      await signIn();
      if (firebase && firebase.auth && firebase.auth().currentUser) {
        signinModal.classList.remove('active');
      }
    });

    document.getElementById('demo-post-btn').addEventListener('click', async () => {
      signinModal.classList.remove('active');
      const videoUrl = localStorage.getItem('recordedVideo');
      if (videoUrl) {
        await uploadDemoPost(videoUrl);
      }
    });

    // Upload functions
    async function uploadAuthenticatedPost(videoUrl) {
      const user = firebase && firebase.auth && firebase.auth().currentUser;
      if (!user) {
        alert('Please sign in before posting.');
        return;
      }

      let idToken = null;
      try {
        idToken = await user.getIdToken(true);
      } catch (e) {
        console.error('Failed to get ID token:', e);
        alert('Authentication error. Please sign in again.');
        return;
      }

      const response = await fetch(videoUrl);
      const blob = await response.blob();
      const formData = new FormData();
      formData.append('media', blob, 'video.webm');
      formData.append('content', currentText || 'New video post');

      try {
        const res = await fetch('/api/posts', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + idToken },
          body: formData
        });
        if (res.ok) {
          alert('Post created successfully!');
          window.location.href = 'Home.html';
        } else {
          let body = null;
          try { body = await res.json(); } catch (e) {}
          console.error('Create post failed', res.status, body);
          alert('Failed to create post: ' + (body && body.error ? body.error : ('Status ' + res.status)));
        }
      } catch (err) {
        console.error('Error posting:', err);
        alert('Error posting video: ' + (err && err.message ? err.message : err));
      }
    }

    async function uploadDemoPost(videoUrl) {
      const response = await fetch(videoUrl);
      const blob = await response.blob();
      const formData = new FormData();
      formData.append('media', blob, 'video.webm');
      formData.append('content', currentText || 'New video post');

      try {
        const res = await fetch('/api/posts/public', {
          method: 'POST',
          body: formData
        });
        if (res.ok) {
          alert('Demo post created successfully!');
          window.location.href = 'Home.html';
        } else {
          let body = null;
          try { body = await res.json(); } catch (e) {}
          console.error('Create demo post failed', res.status, body);
          alert('Failed to create post: ' + (body && body.error ? body.error : ('Status ' + res.status)));
        }
      } catch (err) {
        console.error('Error posting (demo):', err);
        alert('Error posting demo video: ' + (err && err.message ? err.message : err));
      }
    }

    // Update auth UI to show template when signed in
    function updateAuthUI(user) {
      if (user) {
        authBtn.textContent = (user.displayName || user.email || 'Signed in') + ' ‚Äî Sign out';
        postBtn.style.display = 'flex';
        templateGuide.classList.add('show');
      } else {
        authBtn.textContent = 'Sign in';
        postBtn.style.display = 'none';
        templateGuide.classList.remove('show');
      }
    }

    // Re-register auth state listener to use updated updateAuthUI
    if (firebase && firebase.auth) {
      firebase.auth().onAuthStateChanged(async (user) => {
        if (user) {
          try {
            currentIdToken = await user.getIdToken(true);
          } catch (e) {
            console.warn('Failed to get ID token:', e);
            currentIdToken = null;
          }
        } else {
          currentIdToken = null;
        }
        updateAuthUI(user);
      });
    }

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const recordBtn = document.getElementById('record-btn');
    const modeBtn = document.getElementById('mode-btn');
    const musicBtn = document.getElementById('music-btn');
    const saveBtn = document.getElementById('save-btn');
    const effectsToggle = document.getElementById('effects-toggle');
    const textToggle = document.getElementById('text-toggle');
    const effectsPanel = document.getElementById('effects-panel');
    const textInput = document.getElementById('text-input');
    const effectBtns = document.querySelectorAll('.effect-btn');
    const timer = document.getElementById('timer');
    const postBtn = document.getElementById('post-btn');

    let stream;
    let recorder;
    let recordedChunks = [];
    let isRecording = false;
    let currentFilter = 'none';
    let currentText = '';
    let timerInterval;
    let startTime;

    // Set canvas size
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Get user media
    async function startCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        video.srcObject = stream;
      } catch (err) {
        console.error('Error accessing camera:', err);
      }
    }

    // Start recording
    function startRecording() {
      recordedChunks = [];
      recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
      recorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          recordedChunks.push(event.data);
        }
      };
      recorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        // Save to localStorage or download
        localStorage.setItem('recordedVideo', url);
        // Hide timer and show post button
        timer.style.display = 'none';
        postBtn.style.display = 'flex';
        clearInterval(timerInterval);
      };
      recorder.start();
      isRecording = true;
      recordBtn.classList.add('recording');
      // Start timer
      startTime = Date.now();
      timer.style.display = 'block';
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const seconds = (elapsed % 60).toString().padStart(2, '0');
        timer.textContent = `${minutes}:${seconds}`;
      }, 1000);
    }

    // Stop recording
    function stopRecording() {
      recorder.stop();
      isRecording = false;
      recordBtn.classList.remove('recording');
    }

    // Draw canvas
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.filter = currentFilter;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      ctx.filter = 'none';
      if (currentText) {
        ctx.font = '30px Poppins';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(currentText, canvas.width / 2, canvas.height / 2);
      }
      requestAnimationFrame(draw);
    }

    // Event listeners
    recordBtn.addEventListener('click', () => {
      if (isRecording) {
        stopRecording();
      } else {
        startRecording();
      }
    });

    modeBtn.addEventListener('click', () => {
      // Toggle between camera and text mode (simplified)
      alert('Mode switched!');
    });

    musicBtn.addEventListener('click', () => {
      // Add music/sound integration (placeholder)
      alert('Music added!');
    });

    saveBtn.addEventListener('click', () => {
      // Save canvas as image
      const dataURL = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = dataURL;
      link.download = 'post-image.png';
      link.click();
    });

    effectsToggle.addEventListener('click', () => {
      effectsPanel.style.display = effectsPanel.style.display === 'flex' ? 'none' : 'flex';
    });

    textToggle.addEventListener('click', () => {
      textInput.style.display = textInput.style.display === 'block' ? 'none' : 'block';
      if (textInput.style.display === 'block') {
        textInput.focus();
      }
    });

    textInput.addEventListener('input', (e) => {
      currentText = e.target.value;
    });

    effectBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        currentFilter = btn.dataset.filter;
      });
    });

    postBtn.addEventListener('click', async () => {
      const videoUrl = localStorage.getItem('recordedVideo');
      if (!videoUrl) {
        alert('No video recorded!');
        return;
      }

      const user = firebase && firebase.auth && firebase.auth().currentUser;
      if (!user) {
        signinModal.classList.add('active');
        return;
      }

      await uploadAuthenticatedPost(videoUrl);
    });

    // Initialize
    startCamera();
    draw();
  </script>
</body>
</html>
