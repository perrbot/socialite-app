<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Post API</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; }
    .form-group { margin: 15px 0; }
    label { display: block; font-weight: bold; margin-bottom: 5px; }
    input, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
    button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
    button:hover { background: #0056b3; }
    .result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; }
    .error { color: #d32f2f; }
    .success { color: #388e3c; }
    pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Test Post API</h1>
  <p>Test creating a post via the demo (public) endpoint.</p>

  <form id="testForm">
    <div class="form-group">
      <label for="content">Post Content:</label>
      <textarea id="content" placeholder="Enter post content..." rows="4">Test post from API test page</textarea>
    </div>

    <div class="form-group">
      <label for="mediaUrl">Media URL (optional):</label>
      <input type="url" id="mediaUrl" placeholder="https://example.com/image.jpg">
    </div>

    <div class="form-group">
      <label for="thumbnailUrl">Thumbnail URL (optional):</label>
      <input type="url" id="thumbnailUrl" placeholder="https://example.com/thumb.jpg">
    </div>

    <button type="submit">Submit Test Post (POST /api/posts/public)</button>
  </form>

  <div id="result"></div>

  <script>
    const form = document.getElementById('testForm');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const content = document.getElementById('content').value;
      const mediaUrl = document.getElementById('mediaUrl').value || null;
      const thumbnailUrl = document.getElementById('thumbnailUrl').value || null;

      resultDiv.innerHTML = '<p>Submitting...</p>';

      try {
        const response = await fetch('/api/posts/public', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            content,
            mediaUrl,
            thumbnailUrl
          })
        });

        const data = await response.json();

        if (response.ok) {
          resultDiv.innerHTML = `
            <div class="result success">
              <h3>✓ Post Created Successfully!</h3>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>
          `;
          form.reset();
        } else {
          resultDiv.innerHTML = `
            <div class="result error">
              <h3>✗ Failed to Create Post</h3>
              <p>Status: ${response.status}</p>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `
          <div class="result error">
            <h3>✗ Network Error</h3>
            <pre>${err.message}</pre>
            <p>Note: Is the backend running on port 4000?</p>
          </div>
        `;
      }
    });
  </script>
</body>
</html>
